	--betesz egy alkalmazotat vagy
CREATE OR REPLACE FUNCTION Regisztracio(nev felhasznalok.felhasznalonev%TYPE, pss felhasznalok.jelszo%TYPE)
RETURN NUMBER IS db NUMBER;
    max_id NUMBER;
BEGIN
        SELECT felhasznalo_id INTO max_id FROM Felhasznalok  WHERE felhasznalonev = nev;
        RETURN max_id;
        EXCEPTION WHEN NO_DATA_FOUND THEN 
            SELECT MAX(felhasznalo_id)+1 INTO max_id FROM Felhasznalok ;
            db := elsoID;
            INSERT INTO Felhasznalok (felhasznalo_id,felhasznalonev, jelszo, szerep_id)
            VALUES (db,nev, pss, (SELECT szerep_id FROM Szerepkorok WHERE szerepnev = 'csakolvas'));
            RETURN db;
        WHEN OTHERS THEN DBMS_OUTPUT.PUT_LINE('Valami hiba!');
        RECORD_ERROR;
END Regisztracio;
/
CREATE OR REPLACE FUNCTION elsoID
RETURN NUMBER IS
    v_min_id NUMBER;
    CURSOR id_cursor IS SELECT felhasznalo_id FROM felhasznalok ORDER BY felhasznalo_id;
BEGIN
    v_min_id := NULL;
    FOR id_rec IN id_cursor+1 LOOP
        IF id_rec.felhasznalo_id IS NULL THEN
            v_min_id := 1;
        ELSIF id_rec.felhasznalo_id > v_min_id + 1 THEN
            v_min_id := v_min_id + 1;
            RETURN v_min_id;
        ELSE
            v_min_id := id_rec.felhasznalo_id;
        END IF;
    END LOOP;
    RETURN v_min_id + 1;
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RETURN 1;
END elsoID;
/
CREATE OR REPLACE FUNCTION felhasznaloTorles(nev felhasznalok.felhasznalonev%TYPE, pss felhasznalok.jelszo%TYPE)
RETURN NUMBER IS db NUMBER;
    max_id NUMBER;
BEGIN
        SELECT felhasznalo_id INTO max_id FROM Felhasznalok  WHERE felhasznalonev = nev;
        DELETE felhasznalok
        WHERE felhasznalo_id = max_id;
        RETURN max_id;
        EXCEPTION WHEN NO_DATA_FOUND THEN 
        DBMS_OUTPUT.PUT_LINE('Nincs ilyen felhasznalo');
        RETURN -1;
        WHEN OTHERS THEN DBMS_OUTPUT.PUT_LINE('Valami hiba!');
        RECORD_ERROR;
END felhasznaloTorles;
/
SELECT * FROM auto_tipus;
/
CREATE OR REPLACE FUNCTION EvLekeredezes(tipus auto_tipus.auto_tipus%TYPE)
RETURN NUMBER IS db NUMBER;
    max_id NUMBER;
BEGIN
        SELECT auto_tipus_id INTO max_id FROM auto_tipus WHERE auto_tipus = tipus;
        SELECT auto_ev INTO db FROM autok WHERE auto_tipus_id = max_id;
        RETURN db;
        EXCEPTION WHEN NO_DATA_FOUND THEN 
        DBMS_OUTPUT.PUT_LINE('Nincs ilyen auto');
        RETURN -1;
        WHEN OTHERS THEN DBMS_OUTPUT.PUT_LINE('Valami hiba!');
        RECORD_ERROR;
END EvLekeredezes;
/
CREATE OR REPLACE FUNCTION TeljesitmenyLekeredezes(tipus auto_tipus.auto_tipus%TYPE)
RETURN NUMBER IS db NUMBER;
    max_id NUMBER;
BEGIN
        SELECT auto_tipus_id INTO max_id FROM auto_tipus WHERE auto_tipus = tipus;
        SELECT auto_teljesitmeny INTO db FROM autok WHERE auto_tipus_id = max_id;
        RETURN db;
        EXCEPTION WHEN NO_DATA_FOUND THEN 
        DBMS_OUTPUT.PUT_LINE('Nincs ilyen auto');
        RETURN -1;
        WHEN OTHERS THEN DBMS_OUTPUT.PUT_LINE('Valami hiba!');
        RECORD_ERROR;
END TeljesitmenyLekeredezes;
/
CREATE OR REPLACE FUNCTION ArLekeredezes(tipus auto_tipus.auto_tipus%TYPE)
RETURN NUMBER IS db NUMBER;
    max_id NUMBER;
BEGIN
        SELECT auto_tipus_id INTO max_id FROM auto_tipus WHERE auto_tipus = tipus;
        SELECT auto_ar INTO db FROM autok WHERE auto_tipus_id = max_id;
        RETURN db;
        EXCEPTION WHEN NO_DATA_FOUND THEN 
        DBMS_OUTPUT.PUT_LINE('Nincs ilyen auto');
        RETURN -1;
        WHEN OTHERS THEN DBMS_OUTPUT.PUT_LINE('Valami hiba!');
        RECORD_ERROR;
END ArLekeredezes;
/
CREATE OR REPLACE FUNCTION UzemanyagLekeredezes(tipus auto_tipus.auto_tipus%TYPE)
RETURN VARCHAR2 IS db VARCHAR2(250);
    max_id NUMBER;
BEGIN
        SELECT auto_tipus_id INTO max_id FROM auto_tipus WHERE auto_tipus = tipus;
        SELECT auto_uzemanyag INTO db FROM autok WHERE auto_tipus_id = max_id;
        RETURN db;
        EXCEPTION WHEN NO_DATA_FOUND THEN 
        DBMS_OUTPUT.PUT_LINE('Nincs ilyen auto');
        RETURN -1;
        WHEN OTHERS THEN DBMS_OUTPUT.PUT_LINE('Valami hiba!');
        RECORD_ERROR;
END UzemanyagLekeredezes;
/
CREATE OR REPLACE FUNCTION ArAlkatresz(nev Alkatreszek.alkatresz_nev%TYPE)
RETURN NUMBER IS db NUMBER;
    max_id NUMBER;
BEGIN
        SELECT alkatresz_ar INTO db FROM Alkatreszek WHERE alkatresz_nev = nev;
        RETURN db;
        EXCEPTION WHEN NO_DATA_FOUND THEN 
        DBMS_OUTPUT.PUT_LINE('Nincs ilyen auto');
        RETURN -1;
        WHEN OTHERS THEN DBMS_OUTPUT.PUT_LINE('Valami hiba!');
        RECORD_ERROR;
END ArAlkatresz;
/